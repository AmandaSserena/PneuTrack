{% extends "base.html" %}
{% block content %}

{% with m=get_flashed_messages(with_categories=true) %}
  {% if m %}
    {% for cat, msg in m %}
      <div class="alert alert-{{ 'success' if cat=='ok' else 'danger' if cat=='error' else 'info' }} py-2">{{ msg }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}

<h2 class="h4 mb-3">Painel do Gestor</h2>

<nav class="d-flex gap-2 flex-wrap mb-3 small">
  <a href="{{ url_for('veiculos_list') }}">ðŸšš VeÃ­culos</a> |
  <a href="{{ url_for('pneus_list') }}">ðŸ›ž Pneus</a> |
  <a href="{{ url_for('os_list') }}">ðŸ“‹ Ordens de ServiÃ§o</a> |
  <a href="{{ url_for('servicos_autorizados') }}">âœ… ServiÃ§os Autorizados</a> |
  <a href="{{ url_for('barcode_tool') }}">ï¿½ barcode CÃ³digo de Barras</a> |
  <a href="{{ url_for('notificacoes') }}">ðŸ”” NotificaÃ§Ãµes</a>
</nav>

<section class="card p-3 mb-4">
  <h3 class="h6 mb-3">Autorizar novo serviÃ§o</h3>
  <form method="post" action="{{ url_for('gestor_autorizar') }}" class="row g-2 align-items-end">
    <div class="col-sm-4">
      <label class="form-label">VeÃ­culo</label>
      <select class="form-select form-select-sm" name="veiculo_id" required>
        {% for v in veiculos %}
          <option value="{{ v.id }}">{{ v.placa }} â€” {{ v.motorista }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-sm-6">
      <label class="form-label">DescriÃ§Ã£o</label>
      <input class="form-control form-control-sm" type="text" name="descricao" placeholder="Ex.: Troca de pneu dianteiro" required>
    </div>
    <div class="col-sm-2">
      <button class="btn btn-sm btn-primary w-100">Autorizar</button>
    </div>
  </form>
</section>

<section class="mb-4">
  <h3 class="h6 mb-2">ðŸšš VeÃ­culos</h3>
  <div class="table-responsive">
    <table class="table table-sm table-bordered align-middle">
      <thead>
        <tr>
          <th>Placa</th>
          <th>Motorista</th>
          <th style="width:100px">Detalhes</th>
        </tr>
      </thead>
      <tbody>
        {% for v in veiculos %}
        <tr>
          <td class="fw-semibold">{{ v.placa }}</td>
          <td>{{ v.motorista }}</td>
          <td><a class="btn btn-sm btn-outline-primary" href="{{ url_for('veiculo_detail', vid=v.id) }}">Abrir</a></td>
        </tr>
        {% else %}
        <tr><td colspan="3" class="text-muted">Nenhum veÃ­culo.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>

<section class="mb-4">
  <h3 class="h6 mb-2">ðŸ›ž Pneus em Estoque</h3>
  <div class="table-responsive">
    <table class="table table-sm table-bordered align-middle">
      <thead>
        <tr>
          <th>SÃ©rie</th><th>Marca</th><th>Modelo</th><th>Medida</th><th>PressÃ£o</th><th>Sulco</th>
        </tr>
      </thead>
      <tbody>
        {% for p in estoque %}
        <tr>
          <td>{{ p.numero_serie or '-' }}</td>
          <td>{{ p.marca or '-' }}</td>
          <td>{{ p.modelo or '-' }}</td>
          <td>{{ p.medida or '-' }}</td>
          <td>{{ p.pressao }}</td>
          <td>{{ p.sulco }}</td>
        </tr>
        {% else %}
        <tr><td colspan="6" class="text-muted">Sem pneus em estoque.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>

<section>
  <h3 class="h6 mb-2">âœ… ServiÃ§os Autorizados Recentes</h3>
  <div class="table-responsive">
    <table class="table table-sm table-bordered align-middle">
      <thead>
        <tr>
          <th>#</th><th>VeÃ­culo</th><th>DescriÃ§Ã£o</th><th>Status</th><th>Criado em</th>
        </tr>
      </thead>
      <tbody>
        {% for s in servicos %}
        <tr>
          <td>{{ s.id }}</td>
          <td>{{ s.veiculo.placa }}</td>
          <td>{{ s.descricao }}</td>
          <td>{{ s.status }}</td>
          <td>{{ s.created_at.strftime('%d/%m/%Y %H:%M') }}</td>
        </tr>
        {% else %}
        <tr><td colspan="5" class="text-muted">Sem autorizaÃ§Ãµes.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <div class="mt-2">
    <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('servicos_autorizados') }}">Ver todos</a>
  </div>
</section>

{% endblock %}
