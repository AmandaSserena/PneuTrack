
{% extends "base.html" %}
{% block content %}
<h2>Veículo {{ v.placa }} — {{ v.motorista }}</h2>
<form method="post" action="{{ url_for('atualizar_pneus', vid=v.id) }}">
  {% for e in eixos %}
<form method='post' action='{{ url_for("eixo_excluir", eid=e.id) }}' onsubmit="return confirm('Remover eixo?')" style='float:right'>
  <button class='btn small'>Remover eixo</button>
</form>
  <div class="card">
    <h3>{{ e.nome }}</h3>
    <div class="pneu-grid">
      {% for p in grouped.get(e.id, []) %}
      <div class="pneu">
        <div class="pneu-title">{{ p.pos_label }}</div>
        {% if p.pneu %}
          <div class="pneu-meta">Nº fogo: <strong>{{ p.pneu.numero_fogo or '-' }}</strong></div>
          <label>Pressão (psi)</label>
          <input name="pressao_{{p.id}}" type="number" step="0.1" value="{{ p.pneu.pressao }}">
          <label>Sulco (mm)</label>
          <input name="sulco_{{p.id}}" type="number" step="0.1" value="{{ p.pneu.sulco }}">
          <label>Movimentação</label>
          <select name="mov_{{p.id}}">
            <option value="">-- manter --</option>
            <option value="rodizio">Feito rodízio</option>
            <option value="conserto">Foi para o conserto</option>
            <option value="recapagem">Foi para a recapagem</option>
            <option value="estoque">Foi para o estoque</option>
            <option value="vendido">Foi vendido</option>
            <option value="sucateado">Foi sucateado</option>
          </select>
<form method='post' action='{{ url_for("desinstalar_pneu", vid=v.id, pid=p.id) }}' onsubmit="return confirm('Desinstalar pneu?')">
  <button class='btn small'>Desinstalar</button>
</form>
        {% else %}
          <div class="pneu-meta"><em>Sem pneu instalado</em></div>
<a class='btn small outline' href='{{ url_for("instalar_pneu", vid=v.id, pid=p.id) }}'>Instalar pneu</a>
        {% endif %}
      </div>
      {% endfor %}
    </div>
  </div>
  {% endfor %}
  <button class="btn success" type="submit">Enviar para análise</button>
</form>
<div class='card'>
  <h3>Novo Eixo</h3>
  <form method='post' action='{{ url_for("eixo_novo", vid=v.id) }}' class='form'>
    <label>Nome do Eixo</label>
    <input name='nome' placeholder='Ex: Traseiro 2º Eixo'>
    <label>Ordem</label>
    <input name='ordem' type='number' value='0'>
    <button class='btn'>Adicionar eixo</button>
  </form>
</div>
{% endblock %}

<div class="card">
  <h3>Anexos do veículo</h3>
  <form method="post" action="{{ url_for('upload_veiculo', vid=v.id) }}" enctype="multipart/form-data" class="row" style="gap:8px">
    <input type="file" name="arquivo" required>
    <button class="btn">Enviar</button>
  </form>
</div>
<form method="post" action="{{ url_for('inspecao_nova', vid=v.id) }}">
  <button class="btn primary">Nova Inspeção (Checklist)</button>
</form>
